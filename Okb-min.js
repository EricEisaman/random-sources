"x"in[]||"y"in[]||"z"in[]?console.log("Warning: Failed to define xyz properties of Arrays, vectors might not work as expected."):(Object.defineProperty(Array.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t}}),Object.defineProperty(Array.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t}}),Object.defineProperty(Array.prototype,"z",{get:function(){return this[2]},set:function(t){this[2]=t}}));var Okb=new function(){var t=this;this.vector=new function(){var t=this;function r(r){return t.vector(r.x||0,r.y||0,r.z||0)}this.vector=function(t,r,n,e){var o=e;if(o instanceof Array)return[t,r].concat(null!=n&&null!=o.z?[n]:[]);var a=null==e?{x:t,y:r}:Object.assign({},e,{x:t,y:r});return null==n||null!=o&&null==o.z||(a.z=n),a},this.forward=t.vector(0,0,1),this.up=t.vector(0,1,0),this.right=t.vector(1,0,0),this.zero=t.vector(0,0,0),this.rotateAxial=function(n,e,o){n=r(n);var[a,i,l]=[e.x,e.y,e.z],[u,h,s]=[n.x,n.y,n.z],[c,f]=[Math.cos(o),Math.sin(o)],v={};return v[11]=a*a*(1-c)+c,v[12]=i*a*(1-c)-l*f,v[13]=l*a*(1-c)+i*f,v[21]=a*i*(1-c)+l*f,v[22]=i*i*(1-c)+c,v[23]=l*i*(1-c)-a*f,v[31]=a*l*(1-c)-i*f,v[32]=i*l*(1-c)+a*f,v[33]=l*l*(1-c)+c,t.vector(u*v[11]+h*v[12]+s*v[13],u*v[21]+h*v[22]+s*v[23],u*v[31]+h*v[32]+s*v[33],n)},this.rotateEuler=function(r,n){return 0!=n.z&&(r=t.rotateAxial(r,t.forward,n.z)),0!=n.x&&(r=t.rotateAxial(r,t.right,n.x)),0!=n.y&&(r=t.rotateAxial(r,t.up,n.y)),r},this.copy=function(r){return t.vector(r.x,r.y,r.z,r)},this.scale=function(r,n){return t.vector(r.x*n,r.y*n,r.z*n,r)},this.add=function(){for(var r=t.vector(0,0,0,arguments[0]),n=0;n<arguments.length;n++)"number"==typeof arguments[n]?(r.x+=arguments[n]||0,r.y+=arguments[n]||0,null!=r.z&&(r.z+=arguments[n]||0)):(r.x+=arguments[n].x||0,r.y+=arguments[n].y||0,null!=r.z&&(r.z+=arguments[n].z||0));return r},this.multiply=function(){for(var r=t.vector(1,1,1),n=0;n<arguments.length;n++)"number"==typeof arguments[n]?(r.x*=arguments[n]||0,r.y*=arguments[n]||0,r.z*=arguments[n]||0):(r.x*=arguments[n].x||0,r.y*=arguments[n].y||0,r.z*=arguments[n].z||0);return t.vector(r.x,r.y,r.z,arguments[0])},this.subtract=function(n,e){var o=r(n);return e=r(e),t.vector(o.x-e.x,o.y-e.y,o.z-e.z,n)},this.magnitude=function(t){return t=r(t),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},this.norm2=function(t){return(t=r(t)).x*t.x+t.y*t.y+t.z*t.z},this.normalize=function(n){var e=n;n=r(n);var o=t.magnitude(n);if(0==o)return t.vector(n.x,n.y,n.z,e);var a=1/o;return t.vector(n.x*a,n.y*a,n.z*a,e)},this.lerp=function(n,e,o){var a=r(n),i=r(e);return t.vector(a.x*(1-o)+i.x*o,a.y*(1-o)+i.y*o,a.z*(1-o)+i.z*o,n)},this.distance=function(){for(var t=0,n=0;n<arguments.length-1;n++){var e=r(arguments[n]),o=r(arguments[n+1]);t+=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)+Math.pow(e.z-o.z,2))}return t},this.dot=function(t,n){return t=r(t),n=r(n),t.x*n.x+t.y*n.y+t.z*n.z},this.cross=function(n,e){var o=n;return n=r(n),e=r(e),t.vector(n.y*e.z-n.z*e.y,n.z*e.x-n.x*e.z,n.x*e.y-n.y*e.x,o)},this.cosine=function(r,n){return t.dot(r,n)/(t.magnitude(r)*t.magnitude(n))},this.angle=function(r,n){return Math.acos(t.cosine(r,n))},this.elementwise=function(r,n){return t.vector(n(r.x),n(r.y),n(r.z),r)},this.toColumn=function(t){return[[t.x],[t.y],[t.z]]},this.toRow=function(t){return[[t.x,t.y,t.z]]}},this.random=new function(){var r,n=this,e=function(){var t,r,n=4294967296;return{setSeed:function(e){r=t=(null==e?Math.random()*n:e)>>>0},getSeed:function(){return t},rand:function(){return(r=(1664525*r+1013904223)%n)/n}}},o=4,a=.5,i=function(t){return.5*(1-Math.cos(t*Math.PI))};this.perlin=function(t,n,e){if(n=n||0,e=e||0,null==r){r=new Array(4096);for(var l=0;l<4096;l++)r[l]=Math.random()}t<0&&(t=-t),n<0&&(n=-n),e<0&&(e=-e);for(var u,h,s,c,f,v=Math.floor(t),d=Math.floor(n),p=Math.floor(e),g=t-v,y=n-d,M=e-p,x=0,m=.5,b=0;b<o;b++){var z=v+(d<<4)+(p<<8);u=i(g),h=i(y),s=r[4095&z],s+=u*(r[z+1&4095]-s),c=r[z+16&4095],s+=h*((c+=u*(r[z+16+1&4095]-c))-s),c=r[4095&(z+=256)],c+=u*(r[z+1&4095]-c),f=r[z+16&4095],c+=h*((f+=u*(r[z+16+1&4095]-f))-c),x+=(s+=i(M)*(c-s))*m,m*=a,v<<=1,d<<=1,p<<=1,(g*=2)>=1&&(v++,g--),(y*=2)>=1&&(d++,y--),(M*=2)>=1&&(p++,M--)}return x},this.perlinDetail=function(t,r){t>0&&(o=t),r>0&&(a=r)},this.perlinSeed=function(t){var n=e();n.setSeed(t),r=new Array(4096);for(var o=0;o<4096;o++)r[o]=n.rand()};var l=void 0,u=void 0,h=[];this.simplexSeed=function(t){var r=e();r.setSeed(t),u=[];for(var n=0;n<256;n++)u[n]=Math.floor(256*r.rand());for(n=0;n<512;n++)h[n]=u[255&n]},this.simplex=function(t,r,e,o){return t=null!=t?Math.abs(t):0,r=null!=r?Math.abs(r):0,e=null!=e?Math.abs(e):0,o=null!=o?Math.abs(o):0,null==u&&n.simplexSeed((new Date).getTime()),null==l&&(l=new function(){var t=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],r=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];function n(t,r,n,e,o){return t[0]*r+t[1]*n+t[2]*e+t[3]*o}this.noise=function(e,o,a,i){var l,u,s,c,f,v,d,p,g,y,M,x,m=h,b=(Math.sqrt(5)-1)/4,z=(5-Math.sqrt(5))/20,w=(e+o+a+i)*b,P=Math.floor(e+w),S=Math.floor(o+w),I=Math.floor(a+w),k=Math.floor(i+w),A=(P+S+I+k)*z,N=e-(P-A),O=o-(S-A),T=a-(I-A),E=i-(k-A),B=(N>O?32:0)+(N>T?16:0)+(O>T?8:0)+(N>E?4:0)+(O>E?2:0)+(T>E?1:0),j=N-(l=r[B][0]>=3?1:0)+z,q=O-(u=r[B][1]>=3?1:0)+z,C=T-(s=r[B][2]>=3?1:0)+z,D=E-(c=r[B][3]>=3?1:0)+z,L=N-(f=r[B][0]>=2?1:0)+2*z,F=O-(v=r[B][1]>=2?1:0)+2*z,W=T-(d=r[B][2]>=2?1:0)+2*z,K=E-(p=r[B][3]>=2?1:0)+2*z,Q=N-(g=r[B][0]>=1?1:0)+3*z,X=O-(y=r[B][1]>=1?1:0)+3*z,H=T-(M=r[B][2]>=1?1:0)+3*z,R=E-(x=r[B][3]>=1?1:0)+3*z,J=N-1+4*z,Z=O-1+4*z,G=T-1+4*z,U=E-1+4*z,V=255&P,Y=255&S,$=255&I,_=255&k,tt=m[V+m[Y+m[$+m[_]]]]%32,rt=m[V+l+m[Y+u+m[$+s+m[_+c]]]]%32,nt=m[V+f+m[Y+v+m[$+d+m[_+p]]]]%32,et=m[V+g+m[Y+y+m[$+M+m[_+x]]]]%32,ot=m[V+1+m[Y+1+m[$+1+m[_+1]]]]%32,at=.6-N*N-O*O-T*T-E*E,it=.6-j*j-q*q-C*C-D*D,lt=.6-L*L-F*F-W*W-K*K,ut=.6-Q*Q-X*X-H*H-R*R,ht=.6-J*J-Z*Z-G*G-U*U;return 27*((at<0?0:(at*=at)*at*n(t[tt],N,O,T,E))+(it<0?0:(it*=it)*it*n(t[rt],j,q,C,D))+(lt<0?0:(lt*=lt)*lt*n(t[nt],L,F,W,K))+(ut<0?0:(ut*=ut)*ut*n(t[et],Q,X,H,R))+(ht<0?0:(ht*=ht)*ht*n(t[ot],J,Z,G,U)))}}),.5*l.noise(t,r,e,o)+.5};var s=void 0;this.plasmaSeed=function(t){(s=e()).setSeed(t)},this.plasma=function(t){var r=null!=(t=null!=t?t:{}).n?t.n:1,e=null!=t.detail?t.detail:7;null==s&&n.plasmaSeed((new Date).getTime());for(var o=Math.pow(2,r),a=o+1,i=[],l=1/0,u=-1/0,h=0;h<a;h++){i.push([]);for(var c=0;c<a;c++)i[h].push(0)}function f(t){for(var r=0,n=0;n<t.length;n++)t[n]&&(r+=t[n]);return r/t.length}function v(t,r){try{return i[r][t]}catch(t){return 0}}function d(t,r,n){n<l&&(l=n),n>u&&(u=n),i[r][t]=n}function p(t,r,n){d(t,r,f([v(t-n,r-n),v(t+n,r-n),v(t+n,r+n),v(t-n,r+n)])+(2*s.rand()-1)*Math.pow(n,e))}function g(t,r,n){d(t,r,f([v(t,r-n),v(t+n,r),v(t,r+n),v(t-n,r)])+(2*s.rand()-1)*Math.pow(n,e))}!function t(r,n){var e,o,a=r/2;if(!(a<1)){for(o=a;o<n;o+=r)for(e=a;e<n;e+=r)p(e,o,a);for(o=0;o<=n;o+=a)for(e=(o+a)%r;e<=n;e+=r)g(e,o,a);return t(r/2,n)}}(o,o);var y=u-l;return function(t,r){return(i[Math.floor(Math.abs(r%2-1)*o)][Math.floor(Math.abs(t%2-1)*o)]-l)/y}};var c=0;this.valueNoiseSeed=function(t){c=t},this.valueNoise=function(t,r,n){function e(t,r,n){return.5+.5*(t=>t-Math.floor(t))((t+.12)*(r+.34)*(n+.56)*(t+r-n)*Math.PI+c*Math.E)}t=null!=t?Math.abs(t):0,r=null!=r?Math.abs(r):0,n=null!=n?Math.abs(n):0;var o=Math.floor(t),a=Math.floor(r),i=Math.floor(n),l=t-o,u=r-a,h=n-i,s=l*l*(3-2*l),f=u*u*(3-2*u),v=h*h*(3-2*h),d=e(o,a,i),p=e(o+1,a,i),g=e(o,a+1,i),y=e(o+1,a+1,i),M=e(o,a,i+1),x=e(o+1,a,i+1),m=e(o,a+1,i+1);return 2*(d+(p-d)*s+(g-d)*f+(M-d)*v+(d-p-g+y)*s*f+(d-g-M+m)*f*v+(d-p-M+x)*v*s+(-d+p+g-y+M-x-m+e(o+1,a+1,i+1))*s*f*v)-1},this.fractal=function(t,r){var n=null!=(r=null!=r?r:{}).f?r.f:1.98,e=null!=r.s?r.s:.49,o=null!=r.b?r.b:.5,a=null!=r.octaves?r.octaves:2,i=[[0,.8,.6],[-.8,.36,-.48],[-.6,-.48,.64]];return function(r,l,u){r=null!=r?r:0,l=null!=l?l:0,u=null!=u?u:0;for(var h=0,s=0;s<a;s++){var c=t(r,l,u);h+=o*c,o*=e;var f=n*(i[0][0]*r+i[0][1]*l+i[0][2]*u),v=n*(i[1][0]*r+i[1][1]*l+i[1][2]*u),d=n*(i[2][0]*r+i[2][1]*l+i[2][2]*u);r=f,l=v,u=d}return h}};var f=1234,v=999962000357,d=function(t){for(var r=function(t){try{return(t instanceof Buffer?t:Buffer.from(t.toString(),"binary")).toString("base64")}catch(r){return btoa(t)}}(JSON.stringify(t)),n=0,e=0;e<r.length;e++)n+=r.charCodeAt(e)*Math.pow(128,e);return n};this.randomSeed=function(t){var r=t;null==r&&(r=(new Date).getTime());var e=0,o=0;for(;e%999979==0||e%999983==0||0==e||1==e;)e=(d(r)+o)%v,o+=1;f=e;for(var a=0;a<10;a++)n.random()},this.random=function(){return(f=f*f%v)/v},this.seed=function(t){this.randomSeed(t),this.perlinSeed(t),this.plasmaSeed(t),this.simplexSeed(t),this.valueNoiseSeed(t)},this.overwriteDefault=function(){Math.randomSeed=this.randomSeed,Math.random=this.random},this.normalized=function(r,n){return t.math.map(Math.random(),0,1,r,n)},this.weighted=function(t){var r=Math.random();return Math.random()<t(r)?r:n.weighted(t)},this.weighted3d=function(t){var r=Math.random(),e=Math.random(),o=Math.random();return Math.random()<t(r,e,o)?{x:r,y:e,z:o}:n.weighted3d(t)},this.gaussian=function(){return n.weighted(t.curves.gaussian)},this.shuffle=function(t){var r,n,e;for(e=t.length-1;e>0;e--)r=Math.floor(Math.random()*(e+1)),n=t[e],t[e]=t[r],t[r]=n;return t},this.choice=function(t){return t[Math.floor(t.length*Math.random())]},this.loopNoise=function(t){var r=t/2/Math.PI,e=2*Math.PI/t;return function(t,o,a){o=null!=o?o:0,a=null!=a?a:0;var i=e*(t=null!=t?t:0),l=Math.cos(i)*r,u=Math.sin(i)*r;return n.perlin(r+l+a,r+u+a,o)}},this.tileNoise=function(t,r){var e=t/2/Math.PI,o=r/2/Math.PI,a=2*Math.PI/t,i=2*Math.PI/r;return function(t,r,l){l=null!=l?l:0;var u=a*(t=null!=t?t:0),h=i*(r=null!=r?r:0),s=Math.cos(u)*e,c=Math.sin(u)*e,f=Math.cos(h)*o,v=Math.sin(h)*o;return n.simplex(e+s+l,e+c+l,o+f+l,o+v+l)}},this.blue=function(r){var n=null!=(r=null!=r?r:{}).dimension?r.dimension:2,e=null!=r.iteration?r.iteration:20,o=null!=r.sampler?r.sampler:function(){return 1==n?{x:Math.random(),y:0,z:0}:2==n?{x:Math.random(),y:Math.random(),z:0}:3==n?{x:Math.random(),y:Math.random(),z:Math.random()}:void 0},a=[];return function(){for(var r=[],n=0;n<e;n++)r.push(o());var i=0,l=0;for(n=0;n<r.length;n++){for(var u=1/0,h=0;h<a.length;h++){var s=t.vector.distance(a[h],r[n]);s<u&&(u=s)}u>l&&(l=u,i=n)}return a.push(r[i]),r[i]}}},this.curves=new function(){var r=this,n=Math.pow,e=Math.exp,o=Math.cos,a=Math.sin;this.gaussian=function(t){return n(Math.E,-18*n(t-.5,2))},this.gaussian2d=function(t,r){return Math.exp(-Math.pow(t-.5,2)/(.4*.2)-Math.pow(r-.5,2)/(.4*.2))},this.sigmoid=function(t,r){return 1/(1+e(-(r=null!=r?r:10)*(t-.5)))},this.inverseSigmoid=function(t,r){return r=null!=r?r:10,(-.1*Math.log(.00673795*(1/t-1))-.5)*(r/10)+.5},this.bean=function(t){return n(.25-n(t-.5,2),.5)*(2.6+2.4*n(t,1.5))*.54},this.squircle=function(t,r){return function(e){for(;e>Math.PI/2;)e-=Math.PI/2;for(;e<0;)e+=Math.PI/2;return t*n(1/(n(o(e),r)+n(a(e),r)),1/r)}},this.rationalQuadraticBezier=function(r,e,o,a,i){null==a&&(a=2);var l=n(1-i,2)+2*i*(1-i)*a+i*i;return t.vector.vector((n(1-i,2)*r.x+2*i*(1-i)*e.x*a+i*i*o.x)/l,(n(1-i,2)*r.y+2*i*(1-i)*e.y*a+i*i*o.y)/l,(n(1-i,2)*r.z+2*i*(1-i)*e.z*a+i*i*o.z)/l,r)},this.highBezier=function(n,e){return 1==n.length?n[0]:2==n.length?t.vector.lerp(n[0],n[1],e):t.vector.lerp(r.highBezier(n.slice(0,n.length-1),e),r.highBezier(n.slice(1),e),e)},this.smoothen=function(n,e){var o=null!=(e=null!=e?e:{}).weight?e.weight:1,a=null!=e.detail?e.detail:20;2==n.length&&(n=[n[0],t.geometry.midpoint(n[0],n[1]),n[1]]);for(var i=[],l=0;l<n.length-2;l++){var u,h,s;u=0==l?n[l]:t.geometry.midpoint(n[l],n[l+1]),h=n[l+1],s=l==n.length-3?n[l+2]:t.geometry.midpoint(n[l+1],n[l+2]);for(var c=a,f=0;f<c+(l==n.length-3);f+=1){var v=f/c;i.push(r.rationalQuadraticBezier(u,h,s,o,v))}}return i},this.fit=function(n,e){var o=null!=(e=null!=e?e:{}).smooth?e.smooth:.5,a=n;return 0!=e.smooth&&(a=r.smoothen(n,{weight:t.math.map(o,0,1,3,.5),detail:e.detail})),a.sort((t,r)=>t.x-r.x),function(r){for(var n=1;n<a.length;n++)if(r<a[n].x){var e=(r-a[n-1].x)/(a[n].x-a[n-1].x);return t.math.lerp(a[n-1].y,a[n].y,e)}return 0}}},this.math=new function(){this.map=function(t,r,n,e,o){return e+1*(t-r)/(n-r)*(o-e)},this.interpolate=function(t){return function(r,n,e){var o=t(e);return r*(1-o)+n*o}},this.lerp=this.interpolate(t=>t),this.normalizePlusMinusPi=function(t){if(-Math.PI<t&&t<=Math.PI)return t;for(;t<=-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;return t},this.matrixMultiply=function(t,r){for(var n=[],e=0;e<t.length;e++){n[e]=[];for(var o=0;o<r[0].length;o++){for(var a=0,i=0;i<t[0].length;i++)a+=t[e][i]*r[i][o];n[e][o]=a}}return n},this.solveLinearSystem=function(t){function r(t){return Math.abs(t)<1e-4}function n(t,r){return t.map(t=>t*r)}function e(t,r,e){var o=function(t,r){return t.map((t,n)=>t+r[n])}(e,n(r,-e[t]/r[t]));return 0==o.slice(0,-1).filter(t=>0!=t).length?0==o[o.length-1]?"underdetermined":"overdetermined":o}function o(t){for(var n=0,e=0;e<t.length&&r(t[e]);e++)n+=1;return n}function a(t){var r=t.slice();return r.sort((t,r)=>o(t)-o(r)),r}return function(t){function i(){for(var r=0;r<t.length;r++)if(o(t[r])<r)return!1;return!0}for(t=a(t);!i();)for(var l=0;l<t[0].length-2;l++)for(var u=1+l;u<t.length;u++)if(t[u][l]){if(t[u]=e(l,t[l],t[u]),"string"==typeof t[u])return t[u];t=a(t)}for(l=t[0].length-2;l>0;l--)for(u=0;u<l;u++)if(!r(t[u][l])){if(t[u]=e(l,t[l],t[u]),"string"==typeof t[u])return t[u];t=a(t)}for(u=0;u<t.length;u++){var h=1/t[u][u];1!=h&&(t[u]=n(t[u],h))}return t.map(t=>t[t.length-1])}(t.slice())},this.kmeans=function(r,n,e){null==e&&(e=100);var o=r.map((t,r)=>r);t.random.shuffle(o);for(var a=[],i=0;i<n;i++)a.push({center:r[o[i]],data:[]});var l,u=0,h=a.map(t=>-1);function s(){for(var i=0;i<n;i++)a[i].data=[];for(i=0;i<o.length;i++){for(var s=o[i],c=r[s],f=1/0,v=void 0,d=0;d<n;d++){var p=a[d].center,g=t.vector.distance(p,c);g<f&&(f=g,v=d)}a[v].data.push(s)}l=!0;for(i=0;i<n;i++)a[i].center=t.geometry.midpoint(a[i].data.map(t=>r[t])),t.vector.distance(h[i],a[i].center)>Number.EPSILON&&(l=!1);return!(u>=e||l)&&(h=a.map(t=>t.center),u++,!0)}for(;s(););var c=[];for(i=0;i<a.length;i++)for(var f=0;f<a[i].data.length;f++)c[a[i].data[f]]=i;return{centers:a.map(t=>t.center),labels:c,summary:{converged:l,iterations:u}}}},this.geometry=new function(){var r=this;this.midpoint=function(){var r=1==arguments.length?arguments[0]:Array.apply(null,arguments),n=t.vector.add.apply(null,r);return t.vector.scale(n,1/r.length)},this.bound=function(r){for(var n=1/0,e=-1/0,o=1/0,a=-1/0,i=1/0,l=-1/0,u=0;u<r.length;u++)r[u].x<n&&(n=r[u].x),r[u].x>e&&(e=r[u].x),r[u].y<o&&(o=r[u].y),r[u].y>a&&(a=r[u].y),r[u].z<i&&(i=r[u].z),r[u].z>l&&(l=r[u].z);return[t.vector.vector(n,o,i,r[0]),t.vector.vector(e,a,l,r[0])]},this.rectangleBound=function(t){var n=r.bound(t);return{x:n[0].x,y:n[0].y,width:n[1].x-n[0].x,height:n[1].y-n[0].y}},this.lineEquation=function(t,n){var[e,o]=r.slopeIntercept(t,n);return e!=1/0&&e!=-1/0?[e,-1,o]:[-1,0,t.x]},this.distanceToLine=function(t,n){var[e,o,a]=r.lineEquation(...n);return Math.abs(e*t.x+o*t.y+a)/Math.sqrt(e*e+o*o)},this.slopeIntercept=function(t,r){var n=r.x-t.x,e=r.y-t.y,o=n==1/0&&e==1/0||0==n&&0==e?1:e/n;return[o,t.y-o*t.x]},this.projectToQuad=function(n,e){var[o,a,i,l]=e;function u(n,e,o){var a,i=r.slopeIntercept(...e),l=r.slopeIntercept(...o),u=i[0]-l[0];if(Math.abs(u)<1e-5||Math.abs(i[0])==1/0&&Math.abs(l[0])==1/0){var h=r.distanceToLine(n,e),s=r.distanceToLine(n,o),c=r.distanceToLine(e[0],o);return Math.abs(h+s-c)>1e-5?-1:h/(h+s)}if(Math.abs(i[0])==1/0)a=[e[0].x,e[0].x*l[0]+l[1]];else if(Math.abs(l[0])==1/0)a=[o[0].x,o[0].x*i[0]+i[1]];else{var f=(l[1]-i[1])/u;a=[f,i[0]*f+i[1]]}var v=t.vector.subtract(e[0],a),d=t.vector.subtract(o[0],a),p=t.vector.subtract(n,a),g=t.vector.angle(v,p),y=t.vector.angle(v,d),M=t.vector.angle(p,d);return Math.abs(g)>Math.abs(y)||g/y<0||Math.abs(g+M-y)>1e-5?-1:g/y}var h=u(n,[o,l],[a,i]),s=u(n,[o,a],[l,i]);if(-1!=h&&-1!=s)return t.vector.vector(h,s,0,n)},this.intersect=function(n,e,o){null==o&&(o=["segment","segment"]);var a,i,l=function(){var t=r.slopeIntercept(...n),o=r.slopeIntercept(...e),a=t[0]-o[0];if(0==a)return!1;var i=(o[1]-t[1])/a,l=t[0]*i+t[1];return!(!isFinite(i)||!isFinite(l)||isNaN(i)||isNaN(l))&&[i,l]}()||(a=r.lineEquation(...n),i=r.lineEquation(...e),t.math.solveLinearSystem([[a[0],a[1],-a[2]],[i[0],i[1],-i[2]]]));if("overdetermined"==l)return!1;function u(t,n){return"segment"==n?r.bound(t):"ray"==n?r.bound([t[0],Okb.vector.scale(Okb.vector.subtract(t[1],t[0]),1/0)]):"line"==n?[[-1/0,-1/0],[1/0,1/0]]:void 0}function h(t,r){return r[0].x<=t.x&&t.x<=r[1].x&&r[0].y<=t.y&&t.y<=r[1].y}var s=u(n,o[0]),c=u(e,o[1]);return"underdetermined"==l?r.rectangleOverlap(r.rectangleBound(s),r.rectangleBound(c)):!(!h(l,s)||!h(l,c))&&l},this.intersect3d=function(r,n){var e={point:t.vector.vector(0,0,0),parallel:!1,error:0,parameters:[0,0]};function o(t,r,n){var e=t.x,o=t.y,a=t.z,i=r.x,l=r.y,u=r.z,h=n.x,s=n.y,c=n.z;return e*l*c+o*u*h+a*i*s-a*l*h-o*i*c-e*u*s}var a={o:r[0],d:t.vector.subtract(r[1],r[0])},i={o:n[0],d:t.vector.subtract(n[1],n[0])},l=t.vector.cross(a.d,i.d),u=t.vector.norm2(l);if(0==u)return e.parallel=!0,e;var h=o(t.vector.subtract(i.o,a.o),i.d,l)/u,s=o(t.vector.subtract(i.o,a.o),a.d,l)/u,c=t.vector.add(a.o,t.vector.scale(a.d,h)),f=t.vector.add(i.o,t.vector.scale(i.d,s));return e.point=t.vector.scale(t.vector.add(c,f),.5),e.error=Math.sqrt(t.vector.norm2(t.vector.subtract(c,f))),e.parameters[0]=h,e.parameters[1]=s,e},this.pointInPolygon=function(t,n){for(var e=0,o=0;o<n.length;o++){var a=n[o!=n.length-1?o+1:0];0!=r.intersect([n[o],a],[t,[t.x+1,t.y+Math.PI]],["segment","ray"])&&e++}return e%2==1},this.polygonSides=function(t){for(var r=[],n=0;n<t.length;n++){var e=t[n],o=t[n!=t.length-1?n+1:0],a=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2));r.push(a)}return r},this.triangleArea=function(t){var n=r.polygonSides(t),e=n[0],o=n[1],a=n[2],i=(e+o+a)/2;return Math.sqrt(i*(i-e)*(i-o)*(i-a))},this.triangulate=function(t,n){var e=null!=(n=null!=n?n:{}).area?n.area:100,o=null!=n.convex&&n.convex,a=null==n.optimize||n.optimize;function i(t,n){var e=[[0,0],[0,0]],o=.01;e[0][0]=.99*t[0].x+t[1].x*o,e[0][1]=.99*t[0].y+t[1].y*o,e[1][0]=t[0].x*o+.99*t[1].x,e[1][1]=t[0].y*o+.99*t[1].y;for(var a=0;a<n.length;a++){var i=n[a],l=n[a!=n.length-1?a+1:0];if(0!=r.intersect(e,[i,l]))return!1}var u=r.midpoint(t);return 0!=r.pointInPolygon(u,n)}function l(t){return r.triangleArea(t)/r.polygonSides(t).reduce(function(t,r){return t+r},0)}function u(t,n){if(0==t.length)return[];if(r.triangleArea(t)<n)return[t];var e=r.polygonSides(t).reduce((t,r,n,e)=>r>e[t]?n:t,0),o=(e+1)%t.length,a=(e+2)%t.length;try{var i=r.midpoint([t[e],t[o]])}catch(r){return console.log("triangulation err:",t,r),[]}return u([t[e],i,t[a]],n).concat(u([t[a],t[o],i],n))}if(t.length<=3)return u(t,e);var h=function(t){for(var r=[],n=0;n<t.length;n++){var e=t[n],u=t[0!=n?n-1:t.length-1],h=t[n!=t.length-1?n+1:0],s=t.slice();if(s.splice(n,1),o||i([u,h],t)){var c=[[u,e,h],s];if(!a)return c;r.push(c)}}var f=[t,[]],v=0;for(n=0;n<r.length;n++){var d=l(r[n][0]);d>=v&&(f=r[n],v=d)}return f}(t);return u(h[0],e).concat(r.triangulate(h[1],n))},this.rectangleOverlap=function(t,r){return t.x<=r.x+r.width&&t.x+t.width>=r.x&&t.y<=r.y+r.height&&t.y+t.height>=r.y},this.polygonOverlap=function(t,n){for(var e=0;e<t.length;e++)for(var o=[t[e],t[(e+1)%t.length]],a=0;a<n.length;a++){var i=[n[a],n[(a+1)%n.length]];if(r.intersect(o,i))return!0}return!!r.pointInPolygon(t[0],n)||!!r.pointInPolygon(n[0],t)},this.tube=function(r,n){for(var e=r,o=(n=null!=n?n:t=>10,[]),a=[],i=1;i<e.length-1;i++){var l=n(i/e.length),u=Math.atan2(e[i].y-e[i-1].y,e[i].x-e[i-1].x),h=Math.atan2(e[i].y-e[i+1].y,e[i].x-e[i+1].x),s=(u+h)/2;s<h&&(s+=Math.PI);var c=l*Math.cos(s),f=l*Math.sin(s);o.push(t.vector.vector(e[i].x+c,e[i].y+f,e[i].z,e[i])),a.push(t.vector.vector(e[i].x-c,e[i].y-f,e[i].z,e[i]))}var v=e.length-1,d=Math.atan2(e[1].y-e[0].y,e[1].x-e[0].x)-Math.PI/2,p=(u=Math.atan2(e[v].y-e[v-1].y,e[v].x-e[v-1].x)-Math.PI/2,n(0)),g=n(1),y=p*Math.cos(d),M=p*Math.sin(d),x=g*Math.cos(u),m=g*Math.sin(u);return o.unshift(t.vector.vector(e[0].x+y,e[0].y+M,e[0].z,e[0])),a.unshift(t.vector.vector(e[0].x-y,e[0].y-M,e[0].z,e[0])),o.push(t.vector.vector(e[v].x+x,e[v].y+m,e[v].z,e[v])),a.push(t.vector.vector(e[v].x-x,e[v].y-m,e[v].z,e[v])),[o,a]},this.subdivide=function(r,n){for(var e=(r.length-1)*n,o=[],a=0;a<e;a+=1){var i=r[Math.floor(a/n)],l=r[Math.ceil(a/n)],u=a%n/n,h=t.vector.lerp(i,l,u);o.push(h)}return r.length>0&&o.push(r[r.length-1]),o},this.redivide=function(r,n){if(r.length<=1)return r;for(var e=t.vector.distance.apply(null,r)/n,o=0,a=t.vector.distance(r[0],r[1]),i=[],l=0,u=0;u<n+1;u++){for(;l>a+.01&&o<r.length-2;)l-=Math.max(a,.01),o+=1,a=t.vector.distance(r[o],r[o+1]),1;var h=l/a,s=t.vector.lerp(r[o],r[o+1],h);i.push(s),l+=e}return i},this.convexHull=function(t){t.length;var r=t.slice(),n=r.splice(function(t){for(var r=0,n=1/0,e=0;e<t.length;e++)t[e].y<n&&(n=t[e].y,r=e);return r}(t),1)[0],e=t=>Math.atan2(t.y-n.y,t.x-n.x);r.sort((t,r)=>e(t)-e(r)),r.unshift(n);var o,a,i,l=[];l.push(r[0]),l.push(r[1]);for(var u=2;u<r.length;u++){for(;l.length>=2&&(o=l[l.length-2],a=l[l.length-1],i=r[u],(a.x-o.x)*(i.y-o.y)-(a.y-o.y)*(i.x-o.x)<=0);)l.pop();l.push(r[u])}return l}},this.graphics=new function(){var r=this;this.BACKEND="canvas",this.CONTEXT=void 0,this.backend=function(t){r.BACKEND=t},this.context=function(t){r.CONTEXT=t},this.polygon=function(n){var e=null!=(n=null!=n?n:{}).context?n.context:r.CONTEXT,o=null!=n.backend?n.backend:r.BACKEND,a="fill"in n?n.fill:[255,255,255],i="stroke"in n?n.stroke:[0,0,0],l=null!=n.strokeWidth?n.strokeWidth:1,u=null!=n.offset?n.offset:{x:0,y:0},h=null==n.close||n.close;return function(r){if("canvas"==o){e.beginPath(),r.length>0&&e.moveTo(r[0].x+u.x,r[0].y+u.y);for(var n=1;n<r.length;n++)e.lineTo(r[n].x+u.x,r[n].y+u.y);null!=a&&(e.fillStyle=t.color.css(a),e.fill()),null!=i&&(h&&e.lineTo(r[0].x+u.x,r[0].y+u.y),e.strokeStyle=t.color.css(i),e.lineWidth=l,e.stroke())}else{if("svg"==o){var s='<path d ="M';for(n=0;n<r.length+!!h;n++)1==n&&(s+="L"),s+=r[n%r.length].x+u.x+" "+(r[n%r.length].y+u.y)+" ";return s+='" stroke="'+t.color.css(i)+(l>0?'" stroke-width="'+l:"")+'" fill="'+t.color.css(a),s+='"/>'}if("p5"==o){null!=a?e.fill.apply(null,a):e.noFill(),null!=i?(e.stroke.apply(null,i),e.strokeWeight(l)):e.noStroke(),e.beginShape();for(n=0;n<r.length+!!h;n++){var c=u.z,f=n%r.length;null!=r[f].z&&(c=c||0,e.vertex(r[f].x+u.x,r[f].y+u.y,r[f].z+c)),e.vertex(r[f].x+u.x,r[f].y+u.y)}e.endShape()}}}},this.brushstroke=function(n){var e=null!=(n=null!=n?n:{}).color?n.color:[0,0,0],o=Math.random()*Math.PI,a=null!=n.widthFunction?n.widthFunction:r=>10*Math.sin(r*Math.PI)*t.math.map(t.random.perlin(10*r,o),0,1,.7,1);return function(o){var i=null!=n.resample?n.resample:Math.ceil(t.vector.distance.apply(null,o)/10),l=Object.assign({},n,{fill:e,stroke:n.stroke}),u=o;i>0&&(u=t.geometry.redivide(u,i));var[h,s]=t.geometry.tube(u,a);return r.polygon(l)(h.concat(s.slice().reverse()))}},this.projectTexture=function(n){for(var e=null!=(n=null!=n?n:{}).context?n.context:r.CONTEXT,o=null!=n.backend?n.backend:r.BACKEND,a=null!=n.texture?n.texture:[[[0]]],i=null!=n.vertices?n.vertices:[[0,0],[64,0],[64,64],[0,64]],l=null!=n.pixelSize?n.pixelSize:1,[u,h]=t.geometry.bound(i),s="",c=u.x;c<h.x;c+=l)for(var f=u.y;f<h.y;f+=l){var v=t.geometry.projectToQuad([c,f],i);if(null!=v&&0<=v.x&&v.x<=1&&0<=v.y&&v.y<=1){var d;try{d=a[Math.floor(v.y*a.length)][Math.floor(v.x*a[0].length)]}catch(t){continue}null!=d&&("canvas"==o?(e.fillStyle=t.color.css(d),e.fillRect(c,f,l,l)):"p5"==o?(e.fill.apply(null,d),e.noStroke(),e.rect(c,f,l,l)):"svg"==o&&(s+='<path d="M'+c+" "+f+" h"+l+" v"+l+" h -"+l+' Z" fill="'+t.color.css(d)+'" stroke="none"/>'))}}if("svg"==o)return s}},this.color=new function(){var r=this;this.hsv=function(t,r,n){var e=n*r,o=e*(1-Math.abs(t/60%2-1)),a=n-e,[i,l,u]=[[e,o,0],[o,e,0],[0,e,o],[0,o,e],[o,0,e],[e,0,o]][Math.floor(t/60)];return[255*(i+a),255*(l+a),255*(u+a)]},this.css=function(){var t=Math.floor;return 1==arguments.length?null==arguments[0]?"none":"number"==typeof arguments[0]?"rgb("+t(arguments[0])+","+t(arguments[0])+","+t(arguments[0])+")":"string"==typeof arguments[0]?arguments[0]:r.css.apply(null,arguments[0]):2==arguments.length?"rgba("+t(arguments[0])+","+t(arguments[0])+","+t(arguments[0])+","+arguments[1]+")":3==arguments.length?"rgb("+t(arguments[0])+","+t(arguments[1])+","+t(arguments[2])+")":4==arguments.length?"rgba("+t(arguments[0])+","+t(arguments[1])+","+t(arguments[2])+","+arguments[3]+")":void 0},this.lerpHue=function(r,n,e){var o=[[Math.abs(n-r),t.math.map(e,0,1,r,n)],[Math.abs(n+360-r),t.math.map(e,0,1,r,n+360)],[Math.abs(n-360-r),t.math.map(e,0,1,r,n-360)]];return o.sort((t,r)=>t[0]-r[0]),(o[0][1]+720)%360}},this.texture=new function(){this.wood=function(r){for(var n=null!=(r=null!=r?r:{}).width?r.width:512,e=null!=r.height?r.height:512,o=null!=r.scale?r.scale:1,a=null!=r.grain?r.grain:1,i=null!=r.tile&&r.tile,l=null!=r.colorA?r.colorA:[100,50,10],u=null!=r.colorB?r.colorB:[210,162,104],h=[],s=0;s<e;s++){h.push([]);for(var c=0;c<n;c++)h[s].push([0,0,0])}var f=1/(o*n/512),v=e/5*o;for(s=0;s<e+v;s++)for(c=0;c<n;c++){var d=.001*f,p=.004*f,g=.1*f,y=.5*f;if(i)M=Math.floor(1e3*t.random.tileNoise(e*d,n*p)(s*d,c*p)*Math.pow(f,-.8)),x=Math.floor(90*t.random.tileNoise(e*g,n*y)(s*g,c*y)*a);else var M=Math.floor(1e3*t.random.perlin(s*d,c*p)*Math.pow(f,-.8)),x=Math.floor(90*t.random.perlin(s*g,c*y)*a);var m,b=[l[0]-x,l[1]-x,l[2]-x],z=[u[0]-x,u[1]-x,u[2]-x];m=M%40<30?t.vector.lerp(b,z,M%40/30):t.vector.lerp(b,z,(M%40-30)/10);var w=Math.round(s+t.random.perlin(.05*c*f)*v-v);0<=w&&w<e&&(h[w][c]=m)}return h},this.ricePaper=function(r){for(var n=null!=(r=null!=r?r:{}).width?r.width:512,e=null!=r.height?r.height:512,o=null!=r.color?r.color:[250,232,189],a=null!=r.grain?r.grain:20,i=null!=r.sprinkle?r.sprinkle:1,l=[],u=0;u<e;u++){l.push([]);for(var h=0;h<n;h++)l[u].push([0,0,0])}for(u=0;u<e;u++)for(h=0;h<n;h++){var s=255-t.random.perlin(.1*u,.1*h)*a*.5,c=(s-=Math.random()*a)*o[0]/255,f=s*o[1]/255,v=s*o[2]/255;(t.random.perlin(.04*u,.04*h,2)*Math.random()*i>.7||Math.random()<.005*i)&&(c=.7*s,f=.5*s,v=.2*s),l[u][h]=[c,f,v]}return l};this.knitPattern=function(r){for(var n=null!=(r=null!=r?r:{}).width?r.width:128,e=null!=r.height?r.height:128,o=null!=r.mono&&r.mono,a=null!=r.hue?r.hue:360*Math.random(),i=null!=r.scale?r.scale:10,l=[],u=0;u<e;u++){l.push([]);for(var h=0;h<n;h++)l[u].push(o?0:[0,0,0])}var s=function(r,n){return function(e,o,a){null==a&&(a=0);var i=r/2/Math.PI,l=e/r*(2*Math.PI),u=o/n*(2*Math.PI),h=i*Math.sin(l)*Math.cos(u),s=i*Math.sin(l)*Math.sin(u),c=i*Math.cos(l),f=i;return t.random.perlin(f+h,f+s,f+c+a)}}(i,i);for(u=0;u<e;u++)for(h=0;h<n;h++){var c=i*u/e,f=i*h/n;if(o){v=Math.floor(s(f,c));l[u][h]=[v,v,v]}else{var v=s(f,c),d=s(f,c,Math.E),p=s(f,c,Math.PI);l[u][h]=t.color.hsv(Math.floor((360*v+a)%360),d,p)}}return l}},this.explode=function(r){if(null==r&&(r=1),"object"==typeof window){var n=[];if(1==r)for(var e=Object.keys(t),o=0;o<e.length;o++)e[o]in window?console.log("identifier clash: ",e[o],", skipping..."):(window[e[o]]=t[e[o]],n.push(e[o]));else if(r>=2)for(e=Object.keys(t),o=0;o<e.length;o++)for(var a=Object.keys(t[e[o]]),i=0;i<a.length;i++)a[i]in window?console.log("identifier clash: ",a[i],", skipping..."):(window[a[i]]=t[e[o]][a[i]],n.push(a[i]));return console.log("exploded into global scope: ",n),n}console.log("`explode()` only works in browser mode!")}};"object"==typeof module&&(module.exports=Okb);
